# Writes test values over the serial interface

def serialControl as 32
def typeOffset as 1
def flagsOffset as 1
def txOffset as 3

copy val serialControl &rb1

copy &rb1 0 &r1 # For visualization purposes
lsb rb1 typeOffset &r1 # Isolate device type in &r1
sub val 4 &r1 flags # Subtract serial device type
copy pc 0 pc !zero? # Halt: Not a serial device

write:
copy val 42 rb1 3 # Write 42 (ascii '*')


waitForFinish:
and val 1024 rb1 1 flags
copy pc waitForFinish pc !zero?

copy pc write pc
